{"version":3,"sources":["../../src/addon/mod/chat/pages/sessions/sessions.module.ts","../../src/addon/mod/chat/pages/sessions/sessions.ts"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAAqC;AACrC,EAAE;AACF,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,iDAAiD;AACjD,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;;;;;;;AAEQ;AACO;AACM;AACe;AACA;AACf;AAC4B;AAC5B;AAetD;IAAA;IAA6C,CAAC;IAAjC,8BAA8B;QAb1C,uEAAQ,CAAC;YACN,YAAY,EAAE;gBACV,2EAAwB;aAC3B;YACD,OAAO,EAAE;gBACL,2FAAoB;gBACpB,2FAAoB;gBACpB,4EAAe;gBACf,mGAA4B;gBAC5B,sEAAe,CAAC,QAAQ,CAAC,2EAAwB,CAAC;gBAClD,4EAAe,CAAC,QAAQ,EAAE;aAC7B;SACJ,CAAC;OACW,8BAA8B,CAAG;IAAD,qCAAC;CAAA;AAAH;;;;;;;;;ACpC3C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAAqC;AACrC,EAAE;AACF,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,iDAAiD;AACjD,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;;;;;;;;;;AAEoB;AACX;AACa;AACoB;AACd;AACS;AACV;AACD;AAC+C;AAE1G;;GAEG;AAMH;IAeI,kCAAY,SAAoB,EAAU,YAAkC,EAAU,QAA8B,EACpG,YAA8B,EAAU,cAAkC,EAC1E,SAA2B,EAAU,KAAwB;QAF7E,iBAYC;QAZyC,iBAAY,GAAZ,YAAY,CAAsB;QAAU,aAAQ,GAAR,QAAQ,CAAsB;QACpG,iBAAY,GAAZ,YAAY,CAAkB;QAAU,mBAAc,GAAd,cAAc,CAAoB;QAC1E,cAAS,GAAT,SAAS,CAAkB;QAAU,UAAK,GAAL,KAAK,CAAmB;QAVnE,WAAM,GAAG,KAAK,CAAC;QACf,YAAO,GAAG,KAAK,CAAC;QAChB,YAAO,GAAG,CAAC,CAAC;QAEZ,aAAQ,GAAG,EAAE,CAAC;QAOpB,IAAI,CAAC,QAAQ,GAAG,SAAS,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QAC1C,IAAI,CAAC,IAAI,GAAG,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAClC,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QAEtC,IAAI,CAAC,aAAa,EAAE,CAAC,IAAI,CAAC;YACtB,EAAE,CAAC,CAAC,KAAI,CAAC,aAAa,CAAC,IAAI,EAAE,IAAI,KAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;gBACxD,KAAI,CAAC,WAAW,CAAC,KAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;YACvC,CAAC;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IAED;;;;;OAKG;IACH,gDAAa,GAAb,UAAc,WAAqB;QAAnC,iBA0CC;QAzCG,IAAM,KAAK,GAAG,WAAW,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,gBAAgB,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC;QAEpE,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,oBAAoB,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,UAAC,SAAS;YAC7E,KAAI,CAAC,SAAS,GAAG,SAAS,CAAC;YAC3B,KAAI,CAAC,OAAO,GAAG,KAAI,CAAC,cAAc,CAAC,eAAe,CAAC,KAAI,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;YAE5E,MAAM,CAAC,KAAI,CAAC,YAAY,CAAC,WAAW,CAAC,KAAI,CAAC,MAAM,EAAE,KAAI,CAAC,OAAO,EAAE,KAAI,CAAC,OAAO,CAAC,CAAC;QAClF,CAAC,CAAC,CAAC,IAAI,CAAC,UAAC,QAAwC;YAC7C,uBAAuB;YACvB,IAAM,QAAQ,GAAG,EAAE,CAAC;YAEpB,QAAQ,CAAC,OAAO,CAAC,UAAC,OAAO;gBACrB,OAAO,CAAC,QAAQ,GAAG,OAAO,CAAC,UAAU,GAAG,OAAO,CAAC,YAAY,CAAC;gBAC7D,OAAO,CAAC,YAAY,CAAC,OAAO,CAAC,UAAC,WAA6C;oBACvE,EAAE,CAAC,CAAC,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC,CAAC;wBAC5B,4DAA4D;wBAC5D,QAAQ,CAAC,IAAI,CAAC,KAAI,CAAC,YAAY,CAAC,UAAU,CAAC,WAAW,CAAC,MAAM,EAAE,KAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,UAAC,IAAI;4BAC1F,WAAW,CAAC,YAAY,GAAG,IAAI,CAAC,QAAQ,CAAC;wBAC7C,CAAC,CAAC,CAAC,KAAK,CAAC;4BACL,4DAA4D;4BAC5D,WAAW,CAAC,YAAY,GAAG,KAAI,CAAC,SAAS,CAAC,OAAO,CAAC,kBAAkB,CAAC,GAAG,GAAG,GAAG,WAAW,CAAC,MAAM,CAAC;wBACrG,CAAC,CAAC,CAAC,CAAC;oBACR,CAAC;gBACL,CAAC,CAAC,CAAC;gBAEH,kEAAkE;gBAClE,OAAO,CAAC,eAAe,GAAG,OAAO,CAAC,YAAY,CAAC;gBAC/C,EAAE,CAAC,CAAC,OAAO,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;oBAClC,OAAO,CAAC,YAAY,GAAG,OAAO,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC/D,CAAC;YACL,CAAC,CAAC,CAAC;YAEH,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC;gBAC9B,KAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;YAC7B,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC,KAAK,CAAC,UAAC,KAAK;YACX,KAAI,CAAC,QAAQ,CAAC,qBAAqB,CAAC,KAAK,EAAE,0BAA0B,EAAE,IAAI,CAAC,CAAC;QACjF,CAAC,CAAC,CAAC,OAAO,CAAC;YACP,KAAI,CAAC,MAAM,GAAG,IAAI,CAAC;YACnB,KAAK,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC;QAC7B,CAAC,CAAC,CAAC;IACP,CAAC;IAED;;;;OAIG;IACH,kDAAe,GAAf,UAAgB,SAAc;QAA9B,iBAWC;QAVG,IAAM,QAAQ,GAAG;YACb,IAAI,CAAC,cAAc,CAAC,2BAA2B,CAAC,IAAI,CAAC,IAAI,CAAC;YAC1D,IAAI,CAAC,YAAY,CAAC,kBAAkB,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC;SAChF,CAAC;QAEF,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC;YACrC,KAAI,CAAC,aAAa,EAAE,CAAC,OAAO,CAAC;gBACzB,SAAS,CAAC,QAAQ,EAAE,CAAC;YACzB,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC;IAED;;;;OAIG;IACH,8CAAW,GAAX,UAAY,OAAY;QACpB,IAAI,CAAC,oBAAoB,GAAG,OAAO,CAAC,YAAY,CAAC;QACjD,IAAI,CAAC,sBAAsB,GAAG,IAAI,CAAC,OAAO,CAAC;QAC3C,IAAM,MAAM,GAAG;YACX,QAAQ,EAAE,IAAI,CAAC,QAAQ;YACvB,MAAM,EAAE,IAAI,CAAC,MAAM;YACnB,OAAO,EAAE,IAAI,CAAC,OAAO;YACrB,YAAY,EAAE,OAAO,CAAC,YAAY;YAClC,UAAU,EAAE,OAAO,CAAC,UAAU;YAC9B,IAAI,EAAE,IAAI,CAAC,IAAI;SAClB,CAAC;QACF,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,iCAAiC,EAAE,MAAM,CAAC,CAAC;IACvE,CAAC;IAED;;;;;OAKG;IACH,gDAAa,GAAb,UAAc,OAAY,EAAE,MAAa;QACrC,OAAO,CAAC,YAAY,GAAG,OAAO,CAAC,eAAe,CAAC;QAC/C,MAAM,CAAC,eAAe,EAAE,CAAC;IAC7B,CAAC;IA3HkC;QAAlC,yEAAS,CAAC,iGAAsB,CAAC;kCAAgB,iGAAsB;mEAAC;IAFhE,wBAAwB;QAJpC,wEAAS,CAAC;YACP,QAAQ,EAAE,8BAA8B;WACZ;SAC/B,CAAC;8KAgByB,CAA6F;YACtF,6EAAgB,EAA0B,kFAAkB;YAC/D,gBAAgB,EAAiB,GAAiB;OAjBpE,wBAAwB,CA8HpC;IAAD,CAAC;AAAA;SA9HY,wBAAwB,G","file":"109.js","sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { CoreComponentsModule } from '@components/components.module';\nimport { CoreDirectivesModule } from '@directives/directives.module';\nimport { CorePipesModule } from '@pipes/pipes.module';\nimport { AddonModChatComponentsModule } from '../../components/components.module';\nimport { AddonModChatSessionsPage } from './sessions';\n\n@NgModule({\n    declarations: [\n        AddonModChatSessionsPage,\n    ],\n    imports: [\n        CoreComponentsModule,\n        CoreDirectivesModule,\n        CorePipesModule,\n        AddonModChatComponentsModule,\n        IonicPageModule.forChild(AddonModChatSessionsPage),\n        TranslateModule.forChild()\n    ],\n})\nexport class AddonModChatSessionsPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/addon/mod/chat/pages/sessions/sessions.module.ts","// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, ViewChild } from '@angular/core';\nimport { IonicPage, NavParams } from 'ionic-angular';\nimport { TranslateService } from '@ngx-translate/core';\nimport { CoreSplitViewComponent } from '@components/split-view/split-view';\nimport { CoreUserProvider } from '@core/user/providers/user';\nimport { CoreGroupsProvider, CoreGroupInfo } from '@providers/groups';\nimport { CoreDomUtilsProvider } from '@providers/utils/dom';\nimport { CoreUtilsProvider } from '@providers/utils/utils';\nimport { AddonModChatProvider, AddonModChatSession, AddonModChatSessionUser } from '../../providers/chat';\n\n/**\n * Page that displays list of chat sessions.\n */\n@IonicPage({ segment: 'addon-mod-chat-sessions' })\n@Component({\n    selector: 'page-addon-mod-chat-sessions',\n    templateUrl: 'sessions.html',\n})\nexport class AddonModChatSessionsPage {\n\n    @ViewChild(CoreSplitViewComponent) splitviewCtrl: CoreSplitViewComponent;\n\n    protected courseId: number;\n    protected cmId: number;\n    protected chatId: number;\n    protected loaded = false;\n    protected showAll = false;\n    protected groupId = 0;\n    protected groupInfo: CoreGroupInfo;\n    protected sessions = [];\n    protected selectedSessionStart: number;\n    protected selectedSessionGroupId: number;\n\n    constructor(navParams: NavParams, private chatProvider: AddonModChatProvider, private domUtils: CoreDomUtilsProvider,\n            private userProvider: CoreUserProvider, private groupsProvider: CoreGroupsProvider,\n            private translate: TranslateService, private utils: CoreUtilsProvider) {\n        this.courseId = navParams.get('courseId');\n        this.cmId = navParams.get('cmId');\n        this.chatId = navParams.get('chatId');\n\n        this.fetchSessions().then(() => {\n            if (this.splitviewCtrl.isOn() && this.sessions.length > 0) {\n                this.openSession(this.sessions[0]);\n            }\n        });\n    }\n\n    /**\n     * Fetch chat sessions.\n     *\n     * @param showLoading Display a loading modal.\n     * @return Promise resolved when done.\n     */\n    fetchSessions(showLoading?: boolean): Promise<any> {\n        const modal = showLoading ? this.domUtils.showModalLoading() : null;\n\n        return this.groupsProvider.getActivityGroupInfo(this.cmId, false).then((groupInfo) => {\n            this.groupInfo = groupInfo;\n            this.groupId = this.groupsProvider.validateGroupId(this.groupId, groupInfo);\n\n            return this.chatProvider.getSessions(this.chatId, this.groupId, this.showAll);\n        }).then((sessions: AddonModChatSessionFormatted[]) => {\n            // Fetch user profiles.\n            const promises = [];\n\n            sessions.forEach((session) => {\n                session.duration = session.sessionend - session.sessionstart;\n                session.sessionusers.forEach((sessionUser: AddonModChatUserSessionFormatted) => {\n                    if (!sessionUser.userfullname) {\n                        // The WS does not return the user name, fetch user profile.\n                        promises.push(this.userProvider.getProfile(sessionUser.userid, this.courseId, true).then((user) => {\n                            sessionUser.userfullname = user.fullname;\n                        }).catch(() => {\n                            // Error getting profile, most probably the user is deleted.\n                            sessionUser.userfullname = this.translate.instant('core.deleteduser') + ' ' + sessionUser.userid;\n                        }));\n                    }\n                });\n\n                // If session has more than 4 users we display a \"Show more\" link.\n                session.allsessionusers = session.sessionusers;\n                if (session.sessionusers.length > 4) {\n                    session.sessionusers = session.allsessionusers.slice(0, 3);\n                }\n            });\n\n            return Promise.all(promises).then(() => {\n                this.sessions = sessions;\n            });\n        }).catch((error) => {\n            this.domUtils.showErrorModalDefault(error, 'core.errorloadingcontent', true);\n        }).finally(() => {\n            this.loaded = true;\n            modal && modal.dismiss();\n        });\n    }\n\n    /**\n     * Refresh chat sessions.\n     *\n     * @param refresher Refresher.\n     */\n    refreshSessions(refresher: any): void {\n        const promises = [\n            this.groupsProvider.invalidateActivityGroupInfo(this.cmId),\n            this.chatProvider.invalidateSessions(this.chatId, this.groupId, this.showAll)\n        ];\n\n        this.utils.allPromises(promises).finally(() => {\n            this.fetchSessions().finally(() => {\n                refresher.complete();\n            });\n        });\n    }\n\n    /**\n     * Navigate to a session.\n     *\n     * @param session Chat session.\n     */\n    openSession(session: any): void {\n        this.selectedSessionStart = session.sessionstart;\n        this.selectedSessionGroupId = this.groupId;\n        const params = {\n            courseId: this.courseId,\n            chatId: this.chatId,\n            groupId: this.groupId,\n            sessionStart: session.sessionstart,\n            sessionEnd: session.sessionend,\n            cmId: this.cmId\n        };\n        this.splitviewCtrl.push('AddonModChatSessionMessagesPage', params);\n    }\n\n    /**\n     * Show more session users.\n     *\n     * @param session Chat session.\n     * @param $event The event.\n     */\n    showMoreUsers(session: any, $event: Event): void {\n        session.sessionusers = session.allsessionusers;\n        $event.stopPropagation();\n    }\n}\n\n/**\n * Fields added to chat session in this view.\n */\ntype AddonModChatSessionFormatted = AddonModChatSession & {\n    duration?: number; // Session duration.\n    allsessionusers?: AddonModChatUserSessionFormatted[]; // All session users.\n};\n\n/**\n * Fields added to user session in this view.\n */\ntype AddonModChatUserSessionFormatted = AddonModChatSessionUser & {\n    userfullname?: string; // User full name.\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/addon/mod/chat/pages/sessions/sessions.ts"],"sourceRoot":""}