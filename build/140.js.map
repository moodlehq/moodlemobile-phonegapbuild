{"version":3,"sources":["../../src/addon/badges/pages/issued-badge/issued-badge.module.ts","../../src/addon/badges/pages/issued-badge/issued-badge.ts"],"names":[],"mappings":"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","file":"140.js","sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { CoreComponentsModule } from '@components/components.module';\nimport { CoreDirectivesModule } from '@directives/directives.module';\nimport { CorePipesModule } from '@pipes/pipes.module';\nimport { AddonBadgesIssuedBadgePage } from './issued-badge';\n\n@NgModule({\n    declarations: [\n        AddonBadgesIssuedBadgePage,\n    ],\n    imports: [\n        CoreComponentsModule,\n        CoreDirectivesModule,\n        CorePipesModule,\n        IonicPageModule.forChild(AddonBadgesIssuedBadgePage),\n        TranslateModule.forChild()\n    ],\n})\nexport class AddonBadgesIssuedBadgePageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/addon/badges/pages/issued-badge/issued-badge.module.ts","// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, ViewChild } from '@angular/core';\nimport { IonicPage, Content, NavParams } from 'ionic-angular';\nimport { CoreTimeUtilsProvider } from '@providers/utils/time';\nimport { CoreDomUtilsProvider } from '@providers/utils/dom';\nimport { CoreSitesProvider } from '@providers/sites';\nimport { CoreUserProvider } from '@core/user/providers/user';\nimport { CoreCoursesProvider } from '@core/courses/providers/courses';\nimport { AddonBadgesProvider, AddonBadgesUserBadge } from '../../providers/badges';\n\n/**\n * Page that displays the list of calendar events.\n */\n@IonicPage({ segment: 'addon-badges-issued-badge' })\n@Component({\n    selector: 'page-addon-badges-issued-badge',\n    templateUrl: 'issued-badge.html',\n})\nexport class AddonBadgesIssuedBadgePage {\n    @ViewChild(Content) content: Content;\n\n    protected badgeHash: string;\n    protected userId: number;\n    protected courseId: number;\n\n    user: any = {};\n    course: any = {};\n    badge: AddonBadgesUserBadge;\n\n    badgeLoaded = false;\n    currentTime = 0;\n\n    constructor(private badgesProvider: AddonBadgesProvider, navParams: NavParams, sitesProvider: CoreSitesProvider,\n            private domUtils: CoreDomUtilsProvider, private timeUtils: CoreTimeUtilsProvider,\n            private userProvider: CoreUserProvider, private coursesProvider: CoreCoursesProvider) {\n\n        this.courseId = navParams.get('courseId') || 0; // Use 0 for site badges.\n        this.userId = navParams.get('userId') || sitesProvider.getCurrentSite().getUserId();\n        this.badgeHash = navParams.get('badgeHash');\n    }\n\n    /**\n     * View loaded.\n     */\n    ionViewDidLoad(): void {\n\n        this.fetchIssuedBadge().finally(() => {\n            this.badgeLoaded = true;\n        });\n    }\n\n    /**\n     * Fetch the issued badge required for the view.\n     *\n     * @return Promise resolved when done.\n     */\n    fetchIssuedBadge(): Promise<any> {\n        const promises = [];\n\n        this.currentTime = this.timeUtils.timestamp();\n        promises.push(this.userProvider.getProfile(this.userId, this.courseId, true).then((user) => {\n            this.user = user;\n        }));\n\n        promises.push(this.badgesProvider.getUserBadges(this.courseId, this.userId).then((badges) => {\n            const badge = badges.find((badge) => {\n                return this.badgeHash == badge.uniquehash;\n            });\n\n            if (badge) {\n                this.badge = badge;\n                if (badge.courseid) {\n                    return this.coursesProvider.getUserCourse(badge.courseid, true).then((course) => {\n                        this.course = course;\n                    }).catch(() => {\n                        // Maybe an old deleted course.\n                        this.course = null;\n                    });\n                }\n            }\n        }).catch((message) => {\n            this.domUtils.showErrorModalDefault(message, 'Error getting badge data.');\n        }));\n\n        return Promise.all(promises);\n    }\n\n    /**\n     * Refresh the badges.\n     *\n     * @param refresher Refresher.\n     */\n    refreshBadges(refresher: any): void {\n        this.badgesProvider.invalidateUserBadges(this.courseId, this.userId).finally(() => {\n            this.fetchIssuedBadge().finally(() => {\n                refresher.complete();\n            });\n        });\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/addon/badges/pages/issued-badge/issued-badge.ts"],"sourceRoot":""}