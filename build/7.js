webpackJsonp([7],{1786:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),r.d(e,"AddonModScormPlayerPageModule",function(){return h});var i=r(0),o=r(3),s=r(2),n=r(16),a=r(15),c=r(1903),d=this&&this.__decorate||function(t,e,r,i){var o,s=arguments.length,n=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(n=(s<3?o(n):s>3?o(e,r,n):o(e,r))||n);return s>3&&n&&Object.defineProperty(e,r,n),n},h=function(){function t(){}return t=d([Object(i.I)({declarations:[c.a],imports:[n.a,a.a,o.l.forChild(c.a),s.b.forChild()]})],t)}()},1903:function(t,e,r){"use strict";r.d(e,"a",function(){return v});var i=r(0),o=r(3),s=r(12),n=r(4),a=r(52),c=r(9),d=r(22),h=r(131),m=r(407),l=r(248),u=r(1904),f=r(911),p=this&&this.__decorate||function(t,e,r,i){var o,s=arguments.length,n=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(n=(s<3?o(n):s>3?o(e,r,n):o(e,r))||n);return s>3&&n&&Object.defineProperty(e,r,n),n},_=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},v=function(){function t(t,e,r,i,o,s,n,a,c,d){this.popoverCtrl=e,this.eventsProvider=r,this.sitesProvider=i,this.syncProvider=o,this.domUtils=s,this.timeUtils=n,this.scormProvider=a,this.scormHelper=c,this.scormSyncProvider=d,this.loadingToc=!0,this.offline=!1,this.scorm=t.get("scorm")||{},this.mode=t.get("mode")||h.a.MODENORMAL,this.newAttempt=!!t.get("newAttempt"),this.organizationId=t.get("organizationId"),this.initialScoId=t.get("scoId"),this.siteId=this.sitesProvider.getCurrentSiteId(),this.title=this.scorm.name,this.syncProvider.blockOperation(h.a.COMPONENT,this.scorm.id,"player")}return t.prototype.ngOnInit=function(){var t=this;this.showToc=this.scormProvider.displayTocInPlayer(this.scorm),this.scorm.popup&&(this.scorm.width<=100&&(this.scorm.width=this.scorm.width+"%"),this.scorm.height<=100&&(this.scorm.height=this.scorm.height+"%")),this.fetchData().then(function(){if(t.currentSco){return(t.newAttempt?t.setStartTime(t.currentSco.id):Promise.resolve()).catch(function(e){t.domUtils.showErrorModalDefault(e,"addon.mod_scorm.errorgetscorm",!0)}).finally(function(){t.loadSco(t.currentSco)})}}).finally(function(){t.loaded=!0}),this.tocObserver=this.eventsProvider.on(h.a.UPDATE_TOC_EVENT,function(e){e.scormId===t.scorm.id&&(t.offline?setTimeout(t.refreshToc.bind(t),100):t.refreshToc())},this.siteId),this.launchNextObserver=this.eventsProvider.on(h.a.LAUNCH_NEXT_SCO_EVENT,function(e){e.scormId===t.scorm.id&&t.nextSco&&t.loadSco(t.nextSco)},this.siteId),this.launchPrevObserver=this.eventsProvider.on(h.a.LAUNCH_PREV_SCO_EVENT,function(e){e.scormId===t.scorm.id&&t.previousSco&&t.loadSco(t.previousSco)},this.siteId),this.goOfflineObserver=this.eventsProvider.on(h.a.GO_OFFLINE_EVENT,function(e){e.scormId!==t.scorm.id||t.offline||(t.offline=!0,setTimeout(function(){t.scormHelper.convertAttemptToOffline(t.scorm,t.attempt).catch(function(e){t.domUtils.showErrorModalDefault(e,"core.error",!0)}).then(function(){t.refreshToc()})},200))},this.siteId)},t.prototype.calculateNextAndPreviousSco=function(t){this.previousSco=this.scormHelper.getPreviousScoFromToc(this.toc,t),this.nextSco=this.scormHelper.getNextScoFromToc(this.toc,t)},t.prototype.determineAttemptAndMode=function(t){var e,r=this;return this.scormHelper.determineAttemptToContinue(this.scorm,t).then(function(e){return r.attempt=e.number,r.offline=e.offline,r.attempt!=t.lastAttempt.number&&(r.attemptToContinue=r.attempt),r.attempt>0&&r.scormProvider.isAttemptIncomplete(r.scorm.id,r.attempt,r.offline)}).then(function(i){if((e=r.scormProvider.determineAttemptAndMode(r.scorm,r.mode,r.attempt,r.newAttempt,i)).attempt>r.attempt)return r.offline?r.scormHelper.createOfflineAttempt(r.scorm,e.attempt,t.online.length):r.scormProvider.getScormUserData(r.scorm.id,e.attempt,void 0,!1,!0).catch(function(){return r.offline=!0,r.scormHelper.createOfflineAttempt(r.scorm,e.attempt,t.online.length)})}).then(function(){r.mode=e.mode,r.newAttempt=e.newAttempt,r.attempt=e.attempt})},t.prototype.fetchData=function(){var t=this;return this.scormSyncProvider.waitForSync(this.scorm.id).then(function(){return t.scormProvider.getAttemptCount(t.scorm.id).then(function(e){return t.determineAttemptAndMode(e).then(function(){var e=[];return e.push(t.fetchToc()),e.push(t.scormProvider.getScormUserData(t.scorm.id,t.attempt,void 0,t.offline).then(function(e){t.userData=e})),Promise.all(e)})}).catch(function(e){t.domUtils.showErrorModalDefault(e,"addon.mod_scorm.errorgetscorm",!0)})})},t.prototype.fetchToc=function(){var t=this;return this.loadingToc=!0,this.scormProvider.isAttemptIncomplete(this.scorm.id,this.attempt,this.offline).then(function(e){return t.scorm.incomplete=e,t.scormProvider.getOrganizationToc(t.scorm.id,t.attempt,t.organizationId,t.offline)}).then(function(e){if(t.toc=t.scormProvider.formatTocToArray(e),t.toc.forEach(function(e){e.image=t.scormProvider.getScoStatusIcon(e,t.scorm.incomplete)}),t.initialScoId>0&&(t.currentSco=t.scormHelper.getScoFromToc(t.toc,t.initialScoId)),!t.currentSco)return t.scormHelper.getFirstSco(t.scorm.id,t.attempt,t.toc,t.organizationId,t.offline).then(function(e){e?t.currentSco=e:t.errorMessage="addon.mod_scorm.errornovalidsco"})}).finally(function(){t.loadingToc=!1})},t.prototype.ionViewWillLeave=function(){this.src=""},t.prototype.loadSco=function(t){var e=this;if(this.dataModel?this.dataModel.loadSco(t.id):(this.dataModel=new u.a(this.eventsProvider,this.scormProvider,this.siteId,this.scorm,t.id,this.attempt,this.userData,this.mode,this.offline),window.API=this.dataModel),this.currentSco=t,this.title=t.title||this.scorm.name,this.calculateNextAndPreviousSco(t.id),this.scormProvider.getScoSrc(this.scorm,t).then(function(t){t==e.src?(e.src="",setTimeout(function(){e.src=t})):e.src=t}),"asset"==t.scormtype){var r=[{element:"cmi.core.lesson_status",value:"completed"}];this.scormProvider.saveTracks(t.id,this.attempt,r,this.scorm,this.offline).catch(function(){if(!e.offline)return e.scormProvider.getScormUserData(e.scorm.id,e.attempt,void 0,!1).then(function(i){if(!i[t.id]||"completed"!=i[t.id].userdata["cmi.core.lesson_status"])return e.scormHelper.convertAttemptToOffline(e.scorm,e.attempt).then(function(){return e.offline=!0,e.dataModel.setOffline(!0),e.scormProvider.saveTracks(t.id,e.attempt,r,e.scorm,!0)}).catch(function(t){e.domUtils.showErrorModalDefault(t,"core.error",!0)})})}).then(function(){e.refreshToc()})}this.scormProvider.logLaunchSco(this.scorm.id,t.id).catch(function(){})},t.prototype.openToc=function(t){var e=this,r=this.popoverCtrl.create(f.a,{toc:this.toc,attemptToContinue:this.attemptToContinue,mode:this.mode});r.onDidDismiss(function(t){t&&e.loadSco(t)}),r.present({ev:t})},t.prototype.refreshToc=function(){var t=this;return this.scormProvider.invalidateAllScormData(this.scorm.id).catch(function(){}).then(function(){return t.fetchToc()}).catch(function(e){t.domUtils.showErrorModalDefault(e,"addon.mod_scorm.errorgetscorm",!0)})},t.prototype.setStartTime=function(t){var e=this,r=[{element:"x.start.time",value:this.timeUtils.timestamp()}];return this.scormProvider.saveTracks(t,this.attempt,r,this.scorm,this.offline).then(function(){e.offline||e.scormProvider.getAttemptCount(e.scorm.id,!1,!0).catch(function(){})})},t.prototype.ngOnDestroy=function(){this.tocObserver&&this.tocObserver.off(),this.launchNextObserver&&this.launchNextObserver.off(),this.launchPrevObserver&&this.launchPrevObserver.off(),this.goOfflineObserver&&this.goOfflineObserver.off(),this.syncProvider.unblockOperation(h.a.COMPONENT,this.scorm.id,"player")},t=p([Object(i.m)({selector:"page-addon-mod-scorm-player",template:'<ion-header>\n    <ion-navbar>\n        <ion-title><core-format-text [text]="title"></core-format-text></ion-title>\n\n        <ion-buttons end>\n            <button *ngIf="showToc && !loadingToc && toc && toc.length" ion-button icon-only (click)="openToc($event)">\n                <ion-icon name="bookmark"></ion-icon>\n            </button>\n            <ion-spinner *ngIf="showToc && loadingToc"></ion-spinner>\n        </ion-buttons>\n    </ion-navbar>\n</ion-header>\n<ion-content>\n    <core-loading [hideUntil]="loaded">\n        <core-navigation-bar [previous]="previousSco" [next]="nextSco" (action)="loadSco($event)"></core-navigation-bar>\n        <core-iframe *ngIf="loaded && src" [src]="src" [iframeWidth]="scorm.popup ? scorm.width : undefined" [iframeHeight]="scorm.popup ? scorm.height : undefined"></core-iframe>\n        <p *ngIf="!src && errorMessage">{{ errorMessage |Â translate }}</p>\n    </core-loading>\n</ion-content>\n'}),_("design:paramtypes",[o.r,o.t,s.a,n.a,a.a,c.a,d.a,h.a,m.a,l.a])],t)}()},1904:function(t,e,r){"use strict";r.d(e,"a",function(){return o});var i=r(131),o=function(){function t(t,e,r,o,s,n,a,c,d){this.eventsProvider=t,this.scormProvider=e,this.siteId=r,this.scorm=o,this.scoId=s,this.attempt=n,this.mode=c,this.offline=d,this.CMI_STRING_256="^[\\u0000-\\uFFFF]{0,255}$",this.CMI_STRING_4096="^[\\u0000-\\uFFFF]{0,4096}$",this.CMI_TIME="^([0-2]{1}[0-9]{1}):([0-5]{1}[0-9]{1}):([0-5]{1}[0-9]{1})(.[0-9]{1,2})?$",this.CMI_TIMESPAN="^([0-9]{2,4}):([0-9]{2}):([0-9]{2})(.[0-9]{1,2})?$",this.CMI_INTEGER="^\\d+$",this.CMI_SINTEGER="^-?([0-9]+)$",this.CMI_DECIMAL="^-?([0-9]{0,3})(.[0-9]*)?$",this.CMI_IDENTIFIER="^[\\u0021-\\u007E]{0,255}$",this.CMI_FEEDBACK=this.CMI_STRING_256,this.CMI_INDEX="[._](\\d+).",this.CMI_STATUS="^passed$|^completed$|^failed$|^incomplete$|^browsed$",this.CMI_STATUS_2="^passed$|^completed$|^failed$|^incomplete$|^browsed$|^not attempted$",this.CMI_EXIT="^time-out$|^suspend$|^logout$|^$",this.CMI_TYPE="^true-false$|^choice$|^fill-in$|^matching$|^performance$|^sequencing$|^likert$|^numeric$",this.CMI_RESULT="^correct$|^wrong$|^unanticipated$|^neutral$|^([0-9]{0,3})?(.[0-9]*)?$",this.NAV_EVENT="^previous$|^continue$",this.CMI_CHILDREN="core,suspend_data,launch_data,comments,objectives,student_data,student_preference,interactions",this.CORE_CHILDREN="student_id,student_name,lesson_location,credit,lesson_status,entry,score,total_time,lesson_mode,exit,session_time",this.SCORE_CHILDREN="raw,min,max",this.COMMENTS_CHILDREN="content,location,time",this.OBJECTIVES_CHILDREN="id,score,status",this.CORRECT_RESPONSES_CHILDREN="pattern",this.STUDENT_DATA_CHILDREN="mastery_score,max_time_allowed,time_limit_action",this.STUDENT_PREFERENCE_CHILDREN="audio,language,speed,text",this.INTERACTIONS_CHILDREN="id,objectives,time,type,correct_responses,weighting,student_response,result,latency",this.SCORE_RANGE="0#100",this.AUDIO_RANGE="-1#100",this.SPEED_RANGE="-100#100",this.WEIGHTING_RANGE="-100#100",this.TEXT_RANGE="-1#1",this.ERROR_STRINGS={0:"No error",101:"General exception",201:"Invalid argument error",202:"Element cannot have children",203:"Element not an array - cannot have count",301:"Not initialized",401:"Not implemented error",402:"Invalid set value, element is a keyword",403:"Element is read only",404:"Element is write only",405:"Incorrect data type"},this.currentUserData={},this.def={},this.defExtra={},this.dataModel={},this.initialized=!1,this.mode=c||i.a.MODENORMAL,this.offline=!!d,this.init(a)}return t.prototype.addTime=function(t,e){var r=t.split(":"),i=e.split(":"),o=r[2].split("."),s=i[2].split("."),n=0,a=0;o.length>1&&(a=parseInt(o[1],10));var c=0;s.length>1&&(c=parseInt(s[1],10));var d=a+c;d-=100*(n=Math.floor(d/100)),Math.floor(d)<10&&(d="0"+d.toString());var h=parseInt(o[0],10)+parseInt(s[0],10)+n;h-=60*(n=Math.floor(h/60)),Math.floor(h)<10&&(h="0"+h.toString());var m=parseInt(r[1],10)+parseInt(i[1],10)+n;(m-=60*(n=Math.floor(m/60)))<10&&(m="0"+m.toString());var l=parseInt(r[0],10)+parseInt(i[0],10)+n;return l<10&&(l="0"+l.toString()),"0"!=d?l+":"+m+":"+h+"."+d:l+":"+m+":"+h},t.prototype.cloneObj=function(t){if(null==t||"object"!=typeof t)return t;var e=new t.constructor;for(var r in t)e[r]=this.cloneObj(t[r]);return e},t.prototype.collectData=function(){var t=[];for(var e in this.currentUserData[this.scoId])if("cmi"==e.substr(0,3)){var r=new RegExp(this.CMI_INDEX,"g"),i=String(e).replace(r,".n.");if("cmi.core.session_time"!=e&&(void 0===this.dataModel[this.scoId][e]&&void 0!==this.dataModel[this.scoId][i]&&(this.dataModel[this.scoId][e]=this.cloneObj(this.dataModel[this.scoId][i])),void 0!==this.dataModel[this.scoId][e]&&"r"!=this.dataModel[this.scoId][e].mod)){var o={element:e.replace(r,"_$1."),value:this.getEl(e)};void 0!==this.dataModel[this.scoId][e].defaultvalue?this.dataModel[this.scoId][e].defaultvalue==o.value&&typeof this.dataModel[this.scoId][e].defaultvalue==typeof o.value||(t.push(o),this.dataModel[this.scoId][e].defaultvalue=o.value):(t.push(o),this.dataModel[this.scoId][e].defaultvalue=o.value)}}return t},t.prototype.getEl=function(t){return void 0!==this.currentUserData[this.scoId]&&void 0!==this.currentUserData[this.scoId][t]?this.currentUserData[this.scoId][t]:""},t.prototype.init=function(t){for(var e in t){var r=t[e];this.def[e]=r.defaultdata,this.defExtra[e]=r.userdata}for(var e in this.def){this.dataModel[e]={"cmi._children":{defaultvalue:this.CMI_CHILDREN,mod:"r",writeerror:"402"},"cmi._version":{defaultvalue:"3.4",mod:"r",writeerror:"402"},"cmi.core._children":{defaultvalue:this.CORE_CHILDREN,mod:"r",writeerror:"402"},"cmi.core.student_id":{defaultvalue:this.def[e]["cmi.core.student_id"],mod:"r",writeerror:"403"},"cmi.core.student_name":{defaultvalue:this.def[e]["cmi.core.student_name"],mod:"r",writeerror:"403"},"cmi.core.lesson_location":{defaultvalue:this.def[e]["cmi.core.lesson_location"],format:this.CMI_STRING_256,mod:"rw",writeerror:"405"},"cmi.core.credit":{defaultvalue:this.def[e]["cmi.core.credit"],mod:"r",writeerror:"403"},"cmi.core.lesson_status":{defaultvalue:this.def[e]["cmi.core.lesson_status"],format:this.CMI_STATUS,mod:"rw",writeerror:"405"},"cmi.core.entry":{defaultvalue:this.def[e]["cmi.core.entry"],mod:"r",writeerror:"403"},"cmi.core.score._children":{defaultvalue:this.SCORE_CHILDREN,mod:"r",writeerror:"402"},"cmi.core.score.raw":{defaultvalue:this.def[e]["cmi.core.score.raw"],format:this.CMI_DECIMAL,range:this.SCORE_RANGE,mod:"rw",writeerror:"405"},"cmi.core.score.max":{defaultvalue:this.def[e]["cmi.core.score.max"],format:this.CMI_DECIMAL,range:this.SCORE_RANGE,mod:"rw",writeerror:"405"},"cmi.core.score.min":{defaultvalue:this.def[e]["cmi.core.score.min"],format:this.CMI_DECIMAL,range:this.SCORE_RANGE,mod:"rw",writeerror:"405"},"cmi.core.total_time":{defaultvalue:this.def[e]["cmi.core.total_time"],mod:"r",writeerror:"403"},"cmi.core.lesson_mode":{defaultvalue:this.def[e]["cmi.core.lesson_mode"],mod:"r",writeerror:"403"},"cmi.core.exit":{defaultvalue:this.def[e]["cmi.core.exit"],format:this.CMI_EXIT,mod:"w",readerror:"404",writeerror:"405"},"cmi.core.session_time":{format:this.CMI_TIMESPAN,mod:"w",defaultvalue:"00:00:00",readerror:"404",writeerror:"405"},"cmi.suspend_data":{defaultvalue:this.def[e]["cmi.suspend_data"],format:this.CMI_STRING_4096,mod:"rw",writeerror:"405"},"cmi.launch_data":{defaultvalue:this.def[e]["cmi.launch_data"],mod:"r",writeerror:"403"},"cmi.comments":{defaultvalue:this.def[e]["cmi.comments"],format:this.CMI_STRING_4096,mod:"rw",writeerror:"405"},"cmi.evaluation.comments._count":{defaultvalue:"0",mod:"r",writeerror:"402"},"cmi.evaluation.comments._children":{defaultvalue:this.COMMENTS_CHILDREN,mod:"r",writeerror:"402"},"cmi.evaluation.comments.n.content":{defaultvalue:"",pattern:this.CMI_INDEX,format:this.CMI_STRING_256,mod:"rw",writeerror:"405"},"cmi.evaluation.comments.n.location":{defaultvalue:"",pattern:this.CMI_INDEX,format:this.CMI_STRING_256,mod:"rw",writeerror:"405"},"cmi.evaluation.comments.n.time":{defaultvalue:"",pattern:this.CMI_INDEX,format:this.CMI_TIME,mod:"rw",writeerror:"405"},"cmi.comments_from_lms":{mod:"r",writeerror:"403"},"cmi.objectives._children":{defaultvalue:this.OBJECTIVES_CHILDREN,mod:"r",writeerror:"402"},"cmi.objectives._count":{mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.objectives.n.id":{pattern:this.CMI_INDEX,format:this.CMI_IDENTIFIER,mod:"rw",writeerror:"405"},"cmi.objectives.n.score._children":{pattern:this.CMI_INDEX,mod:"r",writeerror:"402"},"cmi.objectives.n.score.raw":{defaultvalue:"",pattern:this.CMI_INDEX,format:this.CMI_DECIMAL,range:this.SCORE_RANGE,mod:"rw",writeerror:"405"},"cmi.objectives.n.score.min":{defaultvalue:"",pattern:this.CMI_INDEX,format:this.CMI_DECIMAL,range:this.SCORE_RANGE,mod:"rw",writeerror:"405"},"cmi.objectives.n.score.max":{defaultvalue:"",pattern:this.CMI_INDEX,format:this.CMI_DECIMAL,range:this.SCORE_RANGE,mod:"rw",writeerror:"405"},"cmi.objectives.n.status":{pattern:this.CMI_INDEX,format:this.CMI_STATUS_2,mod:"rw",writeerror:"405"},"cmi.student_data._children":{defaultvalue:this.STUDENT_DATA_CHILDREN,mod:"r",writeerror:"402"},"cmi.student_data.mastery_score":{defaultvalue:this.def[e]["cmi.student_data.mastery_score"],mod:"r",writeerror:"403"},"cmi.student_data.max_time_allowed":{defaultvalue:this.def[e]["cmi.student_data.max_time_allowed"],mod:"r",writeerror:"403"},"cmi.student_data.time_limit_action":{defaultvalue:this.def[e]["cmi.student_data.time_limit_action"],mod:"r",writeerror:"403"},"cmi.student_preference._children":{defaultvalue:this.STUDENT_PREFERENCE_CHILDREN,mod:"r",writeerror:"402"},"cmi.student_preference.audio":{defaultvalue:this.def[e]["cmi.student_preference.audio"],format:this.CMI_SINTEGER,range:this.AUDIO_RANGE,mod:"rw",writeerror:"405"},"cmi.student_preference.language":{defaultvalue:this.def[e]["cmi.student_preference.language"],format:this.CMI_STRING_256,mod:"rw",writeerror:"405"},"cmi.student_preference.speed":{defaultvalue:this.def[e]["cmi.student_preference.speed"],format:this.CMI_SINTEGER,range:this.SPEED_RANGE,mod:"rw",writeerror:"405"},"cmi.student_preference.text":{defaultvalue:this.def[e]["cmi.student_preference.text"],format:this.CMI_SINTEGER,range:this.TEXT_RANGE,mod:"rw",writeerror:"405"},"cmi.interactions._children":{defaultvalue:this.INTERACTIONS_CHILDREN,mod:"r",writeerror:"402"},"cmi.interactions._count":{mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.interactions.n.id":{pattern:this.CMI_INDEX,format:this.CMI_IDENTIFIER,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.objectives._count":{pattern:this.CMI_INDEX,mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.interactions.n.objectives.n.id":{pattern:this.CMI_INDEX,format:this.CMI_IDENTIFIER,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.time":{pattern:this.CMI_INDEX,format:this.CMI_TIME,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.type":{pattern:this.CMI_INDEX,format:this.CMI_TYPE,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.correct_responses._count":{pattern:this.CMI_INDEX,mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.interactions.n.correct_responses.n.pattern":{pattern:this.CMI_INDEX,format:this.CMI_FEEDBACK,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.weighting":{pattern:this.CMI_INDEX,format:this.CMI_DECIMAL,range:this.WEIGHTING_RANGE,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.student_response":{pattern:this.CMI_INDEX,format:this.CMI_FEEDBACK,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.result":{pattern:this.CMI_INDEX,format:this.CMI_RESULT,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.latency":{pattern:this.CMI_INDEX,format:this.CMI_TIMESPAN,mod:"w",readerror:"404",writeerror:"405"},"nav.event":{defaultvalue:"",format:this.NAV_EVENT,mod:"w",readerror:"404",writeerror:"405"}},this.currentUserData[e]={};for(var o in this.dataModel[e])null===o.match(/\.n\./)&&void 0!==this.dataModel[e][o].defaultvalue&&(this.currentUserData[e][o]=this.dataModel[e][o].defaultvalue);for(var o in this.def[e])null===o.match(/\.n\./)&&(this.currentUserData[e][o]=void 0!==this.dataModel[e][o].defaultvalue?this.dataModel[e][o].defaultvalue:void 0!==this.defExtra[e][o]?this.defExtra[e][o]:"");var s=new RegExp(this.CMI_INDEX,"g");for(var o in this.defExtra[e]){var n="",a=0,c=void 0,d=void 0;o.match(s)&&(c=o.replace(s,".$1."),this.currentUserData[e][c]=this.defExtra[e][o],0===c.indexOf("cmi.evaluation.comments")?(n="cmi.evaluation.comments._count",a=c.match(/.(\d+)./)[1]):0===c.indexOf("cmi.objectives")?(n="cmi.objectives._count",a=c.match(/.(\d+)./)[1]):0===c.indexOf("cmi.interactions")&&(c.indexOf(".objectives.")>0?(d=c.match(/cmi.interactions.(\d+)./)[1],a=c.match(/objectives.(\d+)./)[1],n="cmi.interactions."+d+".objectives._count"):c.indexOf(".correct_responses.")>0?(d=c.match(/cmi.interactions.(\d+)./)[1],a=c.match(/correct_responses.(\d+)./)[1],n="cmi.interactions."+d+".correct_responses._count"):(n="cmi.interactions._count",a=c.match(/.(\d+)./)[1])),n&&(void 0===this.currentUserData[e][n]&&(this.currentUserData[e][n]=0),parseInt(a)==parseInt(this.currentUserData[e][n])&&(this.currentUserData[e][n]=parseInt(this.currentUserData[e][n])+1),parseInt(a)>parseInt(this.currentUserData[e][n])&&(this.currentUserData[e][n]=parseInt(a)-1)))}""===this.currentUserData[e]["cmi.core.lesson_status"]&&(this.currentUserData[e]["cmi.core.lesson_status"]="not attempted"),this.currentUserData[e]["cmi.core.credit"]=this.mode==i.a.MODENORMAL?"credit":"no-credit",this.currentUserData[e]["cmi.core.lesson_mode"]=this.mode}},t.prototype.LMSCommit=function(t){if(this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.errorCode="0",""==t){if(this.initialized){var e=this.storeData(!1);return this.triggerEvent(i.a.UPDATE_TOC_EVENT),this.errorCode=e?"0":"101",e?"true":"false"}this.errorCode="301"}else this.errorCode="201";return"false"},t.prototype.LMSFinish=function(t){if(this.errorCode="0",""==t){if(this.initialized){this.initialized=!1;var e=this.storeData(!0);return""!=this.getEl("nav.event")?"continue"==this.getEl("nav.event")?this.triggerEvent(i.a.LAUNCH_NEXT_SCO_EVENT):this.triggerEvent(i.a.LAUNCH_PREV_SCO_EVENT):"1"==this.scorm.auto&&this.triggerEvent(i.a.LAUNCH_NEXT_SCO_EVENT),this.errorCode=e?"0":"101",this.triggerEvent(i.a.UPDATE_TOC_EVENT),e?"true":"false"}this.errorCode="301"}else this.errorCode="201";return"false"},t.prototype.LMSGetDiagnostic=function(t){return""==t&&(t=this.errorCode),t},t.prototype.LMSGetErrorString=function(t){return""!=t?this.ERROR_STRINGS[t]:""},t.prototype.LMSGetLastError=function(){return this.errorCode},t.prototype.LMSGetValue=function(t){if(this.errorCode="0",this.initialized)if(""!=t){var e=new RegExp(this.CMI_INDEX,"g"),r=String(t).replace(e,".n.");if(void 0!==this.dataModel[this.scoId][r]){if("w"!=this.dataModel[this.scoId][r].mod)return this.errorCode="0",this.getEl(t);this.errorCode=this.dataModel[this.scoId][r].readerror}else{var i="._children";if(r.substr(r.length-i.length,r.length)==i){var o=r.substr(0,r.length-i.length);this.errorCode=void 0!==this.dataModel[this.scoId][o]?"202":"201"}else if("._count"==r.substr(r.length-"._count".length,r.length)){o=r.substr(0,r.length-"._count".length);this.errorCode=void 0!==this.dataModel[this.scoId][o]?"203":"201"}else this.errorCode="201"}}else this.errorCode="201";else this.errorCode="301";return""},t.prototype.LMSInitialize=function(t){if(this.errorCode="0",""==t){if(!this.initialized)return this.initialized=!0,this.errorCode="0","true";this.errorCode="101"}else this.errorCode="201";return"false"},t.prototype.LMSSetValue=function(t,e){if(this.errorCode="0",this.initialized)if(""!=t){var r=new RegExp(this.CMI_INDEX,"g"),i=String(t).replace(r,".n.");if(void 0!==this.dataModel[this.scoId][i])if("r"!=this.dataModel[this.scoId][i].mod){r=new RegExp(this.dataModel[this.scoId][i].format);if(null!=(e+="").match(r)){if(t!=i){if(0===t.indexOf("cmi.objectives")){var o=t.match(/cmi.objectives.(\d+)./)[1];void 0===this.currentUserData[this.scoId][(d="cmi.objectives."+o+".score")+"._children"]&&(this.setEl(this.currentUserData[this.scoId][d+"._children"],this.SCORE_CHILDREN),this.setEl(this.currentUserData[this.scoId][d+".raw"],""),this.setEl(this.currentUserData[this.scoId][d+".min"],""),this.setEl(this.currentUserData[this.scoId][d+".max"],""))}else if(0===t.indexOf("cmi.interactions")){o=t.match(/cmi.interactions.(\d+)./)[1];void 0===this.currentUserData[this.scoId][d="cmi.interactions."+o+".objectives._count"]&&this.setEl(d,0),void 0===this.currentUserData[this.scoId][d="cmi.interactions."+o+".correct_responses._count"]&&this.setEl(d,0)}for(var s=t.split("."),n="cmi",a=1;a<s.length-1;a++){var c=s[a];if(s[a+1].match(/^\d+$/)){var d;if(void 0===this.currentUserData[this.scoId][d=n+"."+c+"._count"]&&this.setEl(d,0),s[a+1]==this.getEl(d)){var h=this.getEl(d);this.setEl(d,parseInt(h,10)+1)}s[a+1]>this.getEl(d)&&(this.errorCode="201"),n=n.concat("."+c+"."+s[a+1]),a++}else n=n.concat("."+c)}t=n.concat("."+s[s.length-1])}if("0"==this.errorCode){if(this.scorm.autocommit&&!this.timeout&&(this.timeout=setTimeout(this.LMSCommit.bind(this),6e4,[""])),void 0===this.dataModel[this.scoId][i].range)return"cmi.comments"==t?this.setEl("cmi.comments",this.getEl("cmi.comments")+e):this.setEl(t,e),this.errorCode="0","true";var m=this.dataModel[this.scoId][i].range.split("#");if((e*=1)>=m[0]&&e<=m[1])return this.setEl(t,e),this.errorCode="0","true";this.errorCode=this.dataModel[this.scoId][i].writeerror}}else this.errorCode=this.dataModel[this.scoId][i].writeerror}else this.errorCode=this.dataModel[this.scoId][i].writeerror;else this.errorCode="201"}else this.errorCode="201";else this.errorCode="301";return"false"},t.prototype.loadSco=function(t){this.scoId=t},t.prototype.setEl=function(t,e){void 0===this.currentUserData[this.scoId]&&(this.currentUserData[this.scoId]={}),this.currentUserData[this.scoId][t]=e},t.prototype.setOffline=function(t){this.offline=t},t.prototype.storeData=function(t){var e;t?("not attempted"==this.getEl("cmi.core.lesson_status")&&this.setEl("cmi.core.lesson_status","completed"),this.getEl("cmi.core.lesson_mode")==i.a.MODENORMAL&&"credit"==this.getEl("cmi.core.credit")&&""!==this.getEl("cmi.student_data.mastery_score")&&""!==this.getEl("cmi.core.score.raw")&&(parseFloat(this.getEl("cmi.core.score.raw"))>=parseFloat(this.getEl("cmi.student_data.mastery_score"))?this.setEl("cmi.core.lesson_status","passed"):this.setEl("cmi.core.lesson_status","failed")),this.getEl("cmi.core.lesson_mode")==i.a.MODEBROWSE&&""==this.dataModel[this.scoId]["cmi.core.lesson_status"].defaultvalue&&"not attempted"==this.getEl("cmi.core.lesson_status")&&this.setEl("cmi.core.lesson_status","browsed"),(e=this.collectData()).push(this.totalTime())):e=this.collectData();var r=this.scormProvider.saveTracksSync(this.scoId,this.attempt,e,this.scorm,this.offline,this.currentUserData);return this.offline||r?r:(this.offline=!0,this.triggerEvent(i.a.GO_OFFLINE_EVENT),this.scormProvider.saveTracksSync(this.scoId,this.attempt,e,this.scorm,this.offline,this.currentUserData))},t.prototype.totalTime=function(){return{element:"cmi.core.total_time",value:this.addTime(this.getEl("cmi.core.total_time"),this.getEl("cmi.core.session_time"))}},t.prototype.triggerEvent=function(t){this.eventsProvider.trigger(t,{scormId:this.scorm.id,scoId:this.scoId,attempt:this.attempt},this.siteId)},t}()}});