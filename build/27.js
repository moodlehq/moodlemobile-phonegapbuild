webpackJsonp([27],{1820:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i.d(e,"CoreLoginSitesPageModule",function(){return c});var n=i(0),o=i(3),r=i(2),a=i(1939),s=i(15),l=this&&this.__decorate||function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,i,a):o(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},c=function(){function t(){}return t=l([Object(n.I)({declarations:[a.a],imports:[s.a,o.l.forChild(a.a),r.b.forChild()]})],t)}()},1939:function(t,e,i){"use strict";i.d(e,"a",function(){return h});var n=i(0),o=i(2),r=i(6),a=i(4),s=i(9),l=i(8),c=i(240),d=i(76),f=this&&this.__decorate||function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,i,a):o(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},u=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},h=function(){function t(t,e,i,n,o,r,a){this.domUtils=t,this.textUtils=e,this.sitesProvider=i,this.loginHelper=n,this.translate=r,this.pushNotificationsProvider=a,this.logger=o.getInstance("CoreLoginSitesPage")}return t.prototype.ionViewDidLoad=function(){var t=this;this.sitesProvider.getSortedSites().then(function(e){t.sites=e.map(function(e){return e.siteUrl=e.siteUrl.replace(/^https?:\/\//,""),e.badge=0,t.pushNotificationsProvider.getSiteCounter(e.id).then(function(t){e.badge=t}),e}),t.showDelete=!1}).catch(function(){})},t.prototype.add=function(){this.loginHelper.goToAddSite(!1)},t.prototype.deleteSite=function(t,e){var i=this;t.stopPropagation();var n=this.sites[e];this.textUtils.formatText(n.siteName).then(function(t){i.domUtils.showConfirm(i.translate.instant("core.login.confirmdeletesite",{sitename:t})).then(function(){i.sitesProvider.deleteSite(n.id).then(function(){i.sites.splice(e,1),i.showDelete=!1,i.sitesProvider.hasSites().then(function(t){t||i.loginHelper.goToAddSite(!0)})}).catch(function(t){i.logger.error("Error deleting site "+n.id,t),i.domUtils.showErrorModalDefault(t,"Delete site failed."),i.domUtils.showErrorModal("core.login.errordeletesite",!0)})}).catch(function(){})})},t.prototype.login=function(t){var e=this,i=this.domUtils.showModalLoading();this.sitesProvider.loadSite(t).then(function(){if(!e.loginHelper.isSiteLoggedOut())return e.loginHelper.goToSiteInitialPage()}).catch(function(i){e.logger.error("Error loading site "+t,i),e.domUtils.showErrorModalDefault(i,"Error loading site.")}).finally(function(){i.dismiss()})},t.prototype.toggleDelete=function(){this.showDelete=!this.showDelete},t=f([Object(n.m)({selector:"page-core-login-sites",template:'<ion-header>\n    <ion-navbar>\n        <ion-title>{{ \'core.settings.sites\' | translate }}</ion-title>\n\n        <ion-buttons end>\n            <button *ngIf="sites && sites.length > 0" ion-button icon-only (click)="toggleDelete()" [attr.aria-label]="\'core.delete\' | translate">\n                <ion-icon name="create" ios="md-create"></ion-icon>\n            </button>\n        </ion-buttons>\n    </ion-navbar>\n</ion-header>\n<ion-content>\n    <ion-list>\n        <ion-item (click)="login(site.id)" *ngFor="let site of sites; let idx = index">\n            <ion-avatar item-start>\n                <img [src]="site.avatar" core-external-content [siteId]="site.id" alt="{{ \'core.pictureof\' | translate:{$a: site.fullname} }}" role="presentation" onError="this.src=\'assets/img/user-avatar.png\'">\n            </ion-avatar>\n            <h2>{{site.fullName}}</h2>\n            <p><core-format-text [text]="site.siteName" clean="true" watch="true" [siteId]="site.id"></core-format-text></p>\n            <p>{{site.siteUrl}}</p>\n            <ion-badge item-end *ngIf="!showDelete && site.badge">{{site.badge}}</ion-badge>\n            <button *ngIf="showDelete" item-end ion-button icon-only clear color="danger" (click)="deleteSite($event, idx)" [attr.aria-label]="\'core.delete\' | translate">\n                <ion-icon name="trash"></ion-icon>\n            </button>\n        </ion-item>\n    </ion-list>\n    <ion-fab bottom right>\n        <button ion-fab (click)="add()" [attr.aria-label]="\'core.add\' | translate">\n            <ion-icon name="add"></ion-icon>\n        </button>\n    </ion-fab>\n</ion-content>\n'}),u("design:paramtypes",[s.a,l.a,a.a,d.a,r.a,o.c,c.a])],t)}()}});